{
  "name": "torch-starter-nvidia (PyTorch + NVIDIA CUDA 12.9)",
  "build": {
    "dockerfile": "Dockerfile",
    "context": "..",
    "options": [
      "--build-arg",
      "BUILDKIT_INLINE_CACHE=1",
      "--platform=linux/amd64"
    ]
  },
  "runArgs": [
    "--gpus=all",
    "--shm-size=8g",
    "--ulimit=memlock=-1",
    "--ulimit=stack=67108864",
    "--cap-add=SYS_PTRACE",
    "--security-opt=seccomp=unconfined",
    "--ipc=host",
    "--network=host"
  ],
  "containerUser": "ubuntu",
  "workspaceFolder": "/workspaces/torch-starter",
  "workspaceMount": "source=torch-starter-workspace,target=/workspaces/torch-starter,type=volume",
  "containerEnv": {
    "CUDA_VISIBLE_DEVICES": "all",
    "NVIDIA_VISIBLE_DEVICES": "all",
    "PYTHONDONTWRITEBYTECODE": "1",
    "PYTHONUNBUFFERED": "1",
    "UV_CACHE_DIR": "/home/ubuntu/.cache/uv",
    "UV_SYSTEM_PYTHON": "1",
    "CUDA_MODULE_LOADING": "LAZY",
    "TORCH_CUDA_ARCH_LIST": "6.0;6.1;7.0;7.5;8.0;8.6;9.0",
    "HF_HOME": "/home/ubuntu/.cache/huggingface",
    "TORCH_HOME": "/home/ubuntu/.cache/torch"
  },
  "mounts": [
    {
      "source": "torch-starter-cache",
      "target": "/home/ubuntu/.cache",
      "type": "volume"
    },
    {
      "source": "torch-starter-uv-cache",
      "target": "/home/ubuntu/.cache/uv",
      "type": "volume"
    }
  ],
  "initializeCommand": [
    "bash",
    "-c",
    "docker volume create torch-starter-workspace 2>/dev/null || true && docker volume create torch-starter-cache 2>/dev/null || true && docker volume create torch-starter-uv-cache 2>/dev/null || true"
  ],
  "postCreateCommand": {
    "setup": "bash -c 'cd /workspaces/torch-starter && echo \"üîß Setting up NVIDIA CUDA environment...\"'",
    "clone": "bash -c 'if [ ! -f \"/workspaces/torch-starter/pyproject.toml\" ]; then echo \"üì• Cloning repository...\"; git clone https://github.com/Timothy-Coulter/ubuntu_p3_12_torch_devcontainer.git /tmp/repo && cp -r /tmp/repo/* /tmp/repo/.[!.]* /workspaces/torch-starter/ 2>/dev/null || true && rm -rf /tmp/repo; fi'",
    "permissions": "bash -c 'sudo chown -R ubuntu:ubuntu /workspaces/torch-starter'",
    "sync": "bash -c 'cd /workspaces/torch-starter && echo \"üì¶ Syncing UV environment with NVIDIA optimizations...\" && uv sync --frozen && echo \"‚úÖ Environment synced with NVIDIA CUDA support\"'",
    "verify": "bash -c 'cd /workspaces/torch-starter && echo \"üîç Running NVIDIA CUDA verification...\" && ./dev.sh verify-setup'",
    "gpu-info": "bash -c 'cd /workspaces/torch-starter && echo \"üñ•Ô∏è  GPU Information:\" && ./dev.sh gpu-info || echo \"‚ö†Ô∏è  GPU not available in this environment\"'",
    "ready": "echo 'üéâ NVIDIA CUDA Development environment ready! Run \"./dev.sh help\" for available commands.'"
  },
  "features": {
    "ghcr.io/devcontainers/features/git:1": {
      "version": "os-provided"
    },
    "ghcr.io/devcontainers/features/nvidia-cuda:1": {
      "installToolkit": false,
      "cudaVersion": "12.9"
    }
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-toolsai.jupyter",
        "charliermarsh.ruff",
        "GitHub.copilot",
        "ms-toolsai.tensorboard",
        "RooVeterinaryInc.roo-cline",
        "gaogaotiantian.viztracer-vscode",
        "redhat.vscode-yaml",
        "nvidia.nsight-vscode-edition",
        "ms-vscode.cpptools"
      ],
      "settings": {
        "python.defaultInterpreterPath": "/workspaces/torch-starter/.venv/bin/python",
        "python.terminal.activateEnvironment": false,
        "ruff.enable": true,
        "jupyter.defaultKernel": "Python 3.12.8",
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.cwd": "/workspaces/torch-starter",
        "files.watcherExclude": {
          "**/node_modules/**": true,
          "**/.venv/**": true,
          "**/data/**": true,
          "**/logs/**": true,
          "**/models/**": true,
          "**/.cache/**": true
        },
        "search.exclude": {
          "**/node_modules": true,
          "**/bower_components": true,
          "**/.venv": true,
          "**/data": true,
          "**/logs": true,
          "**/models": true,
          "**/.cache": true
        }
      }
    }
  },
  "shutdownAction": "stopContainer",
  "hostRequirements": {
    "gpu": "optional",
    "memory": "8gb",
    "cpus": 4
  },
  "waitFor": "postCreateCommand",
  "portsAttributes": {
    "8888": {
      "label": "Jupyter Lab",
      "onAutoForward": "notify"
    },
    "8000": {
      "label": "Development Server",
      "onAutoForward": "notify"
    },
    "6006": {
      "label": "TensorBoard",
      "onAutoForward": "notify"
    },
    "8080": {
      "label": "Web App",
      "onAutoForward": "notify"
    }
  }
}